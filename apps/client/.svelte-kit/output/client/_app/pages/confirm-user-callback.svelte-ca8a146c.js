import{S as M,i as N,s as I,e as h,w as E,c as k,a as $,x as j,d as f,b as w,g as d,y as C,q as g,o as b,B as P,l as q,p as R,t as v,h as y,Q as _,k as H,m as S,j as T,n as V}from"../chunks/vendor-e5aa1018.js";import{e as Y}from"../chunks/env-cb046133.js";import{g as z}from"../chunks/gqlRequest-8b3b303a.js";import{C as B}from"../chunks/Card-0dca4eaa.js";import{D as Q}from"../chunks/DangerTriangle-248b2e37.js";const U=i=>`#graphql
mutation VerifyEmailAddress ($email: String!, $token: String!) {
  verifyEmailAddress(token: $token, email: $email) {
    ${i}
  }
}`;function x(i){let r,a,e;return a=new B({props:{$$slots:{default:[F]},$$scope:{ctx:i}}}),{c(){r=h("main"),E(a.$$.fragment),this.h()},l(t){r=k(t,"MAIN",{class:!0});var s=$(r);j(a.$$.fragment,s),s.forEach(f),this.h()},h(){w(r,"class","confirm-user-callback svelte-1wq0ik0")},m(t,s){d(t,r,s),C(a,r,null),e=!0},p(t,s){const o={};s&3&&(o.$$scope={dirty:s,ctx:t}),a.$set(o)},i(t){e||(g(a.$$.fragment,t),e=!0)},o(t){b(a.$$.fragment,t),e=!1},d(t){t&&f(r),P(a)}}}function D(i){let r,a,e,t,s;return{c(){r=h("p"),a=v("You can you send yourself another one "),e=h("a"),t=v("here"),s=v("."),this.h()},l(o){r=k(o,"P",{});var m=$(r);a=y(m,"You can you send yourself another one "),e=k(m,"A",{href:!0,"sveltekit:prefetch":!0});var u=$(e);t=y(u,"here"),u.forEach(f),s=y(m,"."),m.forEach(f),this.h()},h(){w(e,"href","/verify-email"),w(e,"sveltekit:prefetch","")},m(o,m){d(o,r,m),_(r,a),_(r,e),_(e,t),_(r,s)},d(o){o&&f(r)}}}function F(i){let r,a,e,t,s,o,m,u,p;a=new Q({});let l=i[0]==="Magic link expired. Please send yourself another confirmation email and try again."&&D();return{c(){r=h("h2"),E(a.$$.fragment),e=v(" Hmm, that magic link didn't work"),t=H(),s=h("p"),o=v(i[0]),m=H(),l&&l.c(),u=q()},l(n){r=k(n,"H2",{});var c=$(r);j(a.$$.fragment,c),e=y(c," Hmm, that magic link didn't work"),c.forEach(f),t=S(n),s=k(n,"P",{});var A=$(s);o=y(A,i[0]),A.forEach(f),m=S(n),l&&l.l(n),u=q()},m(n,c){d(n,r,c),C(a,r,null),_(r,e),d(n,t,c),d(n,s,c),_(s,o),d(n,m,c),l&&l.m(n,c),d(n,u,c),p=!0},p(n,c){(!p||c&1)&&T(o,n[0]),n[0]==="Magic link expired. Please send yourself another confirmation email and try again."?l||(l=D(),l.c(),l.m(u.parentNode,u)):l&&(l.d(1),l=null)},i(n){p||(g(a.$$.fragment,n),p=!0)},o(n){b(a.$$.fragment,n),p=!1},d(n){n&&f(r),P(a),n&&f(t),n&&f(s),n&&f(m),l&&l.d(n),n&&f(u)}}}function G(i){let r,a,e=i[0]&&x(i);return{c(){e&&e.c(),r=q()},l(t){e&&e.l(t),r=q()},m(t,s){e&&e.m(t,s),d(t,r,s),a=!0},p(t,[s]){t[0]?e?(e.p(t,s),s&1&&g(e,1)):(e=x(t),e.c(),g(e,1),e.m(r.parentNode,r)):e&&(V(),b(e,1,1,()=>{e=null}),R())},i(t){a||(g(e),a=!0)},o(t){b(e),a=!1},d(t){e&&e.d(t),t&&f(r)}}}async function Z({fetch:i,url:r}){const a=r.searchParams.get("email"),e=r.searchParams.get("token");if(!e||!a)return{redirect:"/__error",status:303};const s=await(await i(`${Y.viteHostAddress}/proxy/verify-email-address`,z({query:U(`
          id
          email
          username
          emailIsVerified
          cred
          isAdmin
          banned
          createdAt
        `),variables:{token:e,email:a}}))).json();return s.error?{props:{error:s.error.message}}:{status:303,redirect:"/log-in"}}function J(i,r,a){let{error:e}=r;return i.$$set=t=>{"error"in t&&a(0,e=t.error)},[e]}class ee extends M{constructor(r){super();N(this,r,J,G,I,{error:0})}}export{ee as default,Z as load};
