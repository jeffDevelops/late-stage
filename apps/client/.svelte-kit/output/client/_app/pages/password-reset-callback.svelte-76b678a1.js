var _e=Object.defineProperty,be=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var ce=(l,e,t)=>e in l?_e(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,ue=(l,e)=>{for(var t in e||(e={}))ge.call(e,t)&&ce(l,t,e[t]);if(ie)for(var t of ie(e))we.call(e,t)&&ce(l,t,e[t]);return l},fe=(l,e)=>be(l,ke(e));import{S as ye,i as ve,s as Ee,e as k,t as A,k as q,w as X,c as g,a as E,h as O,d as u,m as I,x as F,b as f,g as S,Q as c,y as G,q as C,o as M,B as K,R as Pe,j as $e,X as Re,V as Q,a4 as je,n as Ue,p as Te,_ as qe,a5 as J}from"../chunks/vendor-82c75a9c.js";import{g as Ie}from"../chunks/navigation-6e098c45.js";import{s as Se}from"../chunks/stores-3e2e9e39.js";import{C as Ae}from"../chunks/Card-1275b158.js";import{V as Oe,a as Ne}from"../chunks/VisibilityOff-585519f3.js";import{L as Ve}from"../chunks/Lock-e2660896.js";import{g as de}from"../chunks/gqlRequest-8b3b303a.js";import{c as Le}from"../chunks/CurrentUser-cb94d366.js";import{d as Ce}from"../chunks/disableInteractablesWhile-0e82c9c8.js";import{n as Me}from"../chunks/NavigationPriorToLogin-f1dc7702.js";import"../chunks/singletons-d19c42e4.js";const Be=`#graphql
mutation UpdatePassword ($password: String!, $token: String!, $email: String!) {
  updatePassword(password: $password, token: $token, email: $email)
}
`;function De(l){let e,t,s;return{c(){e=k("input"),this.h()},l(r){e=g(r,"INPUT",{type:!0,id:!0,class:!0}),this.h()},h(){f(e,"type","text"),f(e,"id","log-in-password"),f(e,"class","svelte-lb28ls")},m(r,a){S(r,e,a),J(e,l[0]),t||(s=Q(e,"input",l[8]),t=!0)},p(r,a){a&1&&e.value!==r[0]&&J(e,r[0])},d(r){r&&u(e),t=!1,s()}}}function He(l){let e,t,s;return{c(){e=k("input"),this.h()},l(r){e=g(r,"INPUT",{type:!0,id:!0,class:!0}),this.h()},h(){f(e,"type","password"),f(e,"id","log-in-password"),f(e,"class","svelte-lb28ls")},m(r,a){S(r,e,a),J(e,l[0]),t||(s=Q(e,"input",l[7]),t=!0)},p(r,a){a&1&&e.value!==r[0]&&J(e,r[0])},d(r){r&&u(e),t=!1,s()}}}function ze(l){let e,t;return e=new Oe({}),{c(){X(e.$$.fragment)},l(s){F(e.$$.fragment,s)},m(s,r){G(e,s,r),t=!0},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){M(e.$$.fragment,s),t=!1},d(s){K(e,s)}}}function We(l){let e,t;return e=new Ne({}),{c(){X(e.$$.fragment)},l(s){F(e.$$.fragment,s)},m(s,r){G(e,s,r),t=!0},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){M(e.$$.fragment,s),t=!1},d(s){K(e,s)}}}function me(l){let e,t;return{c(){e=k("p"),t=A("Password must be at least 8 characters"),this.h()},l(s){e=g(s,"P",{class:!0});var r=E(e);t=O(r,"Password must be at least 8 characters"),r.forEach(u),this.h()},h(){f(e,"class","error")},m(s,r){S(s,e,r),c(e,t)},d(s){s&&u(e)}}}function pe(l){let e,t;return{c(){e=k("p"),t=A(l[3]),this.h()},l(s){e=g(s,"P",{class:!0});var r=E(e);t=O(r,l[3]),r.forEach(u),this.h()},h(){f(e,"class","error-message")},m(s,r){S(s,e,r),c(e,t)},p(s,r){r&8&&$e(t,s[3])},d(s){s&&u(e)}}}function he(l){let e,t,s;return{c(){e=k("p"),t=k("a"),s=A("Try Again"),this.h()},l(r){e=g(r,"P",{class:!0});var a=E(e);t=g(a,"A",{href:!0});var o=E(t);s=O(o,"Try Again"),o.forEach(u),a.forEach(u),this.h()},h(){f(t,"href","/reset-password"),f(e,"class","error")},m(r,a){S(r,e,a),c(e,t),c(t,s)},d(r){r&&u(e)}}}function Xe(l){let e,t,s,r,a,o,$,w,d,p,i,m,h,R,N,B,U,V,T,D,H,x,ee;t=new Ve({});function te(n,P){return n[1]?He:De}let z=te(l),j=z(l);const se=[We,ze],L=[];function re(n,P){return n[1]?0:1}m=re(l),h=L[m]=se[m](l);let y=l[2]&&l[0].length<8&&me(),_=l[3]&&pe(l),v=(l[3]===Y||l[3]===Z)&&he();return{c(){e=k("h4"),X(t.$$.fragment),s=A(" Enter your new password"),r=q(),a=k("form"),o=k("label"),$=A("Password"),w=q(),d=k("div"),j.c(),p=q(),i=k("button"),h.c(),R=q(),y&&y.c(),N=q(),_&&_.c(),B=q(),v&&v.c(),U=q(),V=k("div"),T=k("button"),D=A("Update Password"),this.h()},l(n){e=g(n,"H4",{});var P=E(e);F(t.$$.fragment,P),s=O(P," Enter your new password"),P.forEach(u),r=I(n),a=g(n,"FORM",{class:!0});var b=E(a);o=g(b,"LABEL",{for:!0});var ae=E(o);$=O(ae,"Password"),ae.forEach(u),w=I(b),d=g(b,"DIV",{class:!0});var W=E(d);j.l(W),p=I(W),i=g(W,"BUTTON",{type:!0,class:!0});var le=E(i);h.l(le),le.forEach(u),W.forEach(u),R=I(b),y&&y.l(b),N=I(b),_&&_.l(b),B=I(b),v&&v.l(b),U=I(b),V=g(b,"DIV",{class:!0});var ne=E(V);T=g(ne,"BUTTON",{type:!0,class:!0});var oe=E(T);D=O(oe,"Update Password"),oe.forEach(u),ne.forEach(u),b.forEach(u),this.h()},h(){f(o,"for","log-in-password"),f(i,"type","button"),f(i,"class","secondary svelte-lb28ls"),Re(i,"disabled",Ge),f(d,"class","flex svelte-lb28ls"),f(T,"type","submit"),f(T,"class","primary svelte-lb28ls"),f(V,"class","action svelte-lb28ls"),f(a,"class","svelte-lb28ls")},m(n,P){S(n,e,P),G(t,e,null),c(e,s),S(n,r,P),S(n,a,P),c(a,o),c(o,$),c(a,w),c(a,d),j.m(d,null),c(d,p),c(d,i),L[m].m(i,null),c(a,R),y&&y.m(a,null),c(a,N),_&&_.m(a,null),c(a,B),v&&v.m(a,null),c(a,U),c(a,V),c(V,T),c(T,D),H=!0,x||(ee=[Q(i,"click",l[9]),Q(a,"submit",je(l[4]))],x=!0)},p(n,P){z===(z=te(n))&&j?j.p(n,P):(j.d(1),j=z(n),j&&(j.c(),j.m(d,p)));let b=m;m=re(n),m!==b&&(Ue(),M(L[b],1,1,()=>{L[b]=null}),Te(),h=L[m],h||(h=L[m]=se[m](n),h.c()),C(h,1),h.m(i,null)),n[2]&&n[0].length<8?y||(y=me(),y.c(),y.m(a,N)):y&&(y.d(1),y=null),n[3]?_?_.p(n,P):(_=pe(n),_.c(),_.m(a,B)):_&&(_.d(1),_=null),n[3]===Y||n[3]===Z?v||(v=he(),v.c(),v.m(a,U)):v&&(v.d(1),v=null)},i(n){H||(C(t.$$.fragment,n),C(h),H=!0)},o(n){M(t.$$.fragment,n),M(h),H=!1},d(n){n&&u(e),K(t),n&&u(r),n&&u(a),j.d(),L[m].d(),y&&y.d(),_&&_.d(),v&&v.d(),x=!1,qe(ee)}}}function Fe(l){let e,t,s,r,a,o,$,w,d;return w=new Ae({props:{$$slots:{default:[Xe]},$$scope:{ctx:l}}}),{c(){e=k("main"),t=k("h1"),s=A("Reset Password"),r=q(),a=k("h4"),o=A("(Step 2 of 2)"),$=q(),X(w.$$.fragment),this.h()},l(p){e=g(p,"MAIN",{id:!0,class:!0});var i=E(e);t=g(i,"H1",{});var m=E(t);s=O(m,"Reset Password"),m.forEach(u),r=I(i),a=g(i,"H4",{});var h=E(a);o=O(h,"(Step 2 of 2)"),h.forEach(u),$=I(i),F(w.$$.fragment,i),i.forEach(u),this.h()},h(){f(e,"id","password-reset"),f(e,"class","svelte-lb28ls")},m(p,i){S(p,e,i),c(e,t),c(t,s),c(e,r),c(e,a),c(a,o),c(e,$),G(w,e,null),d=!0},p(p,[i]){const m={};i&2063&&(m.$$scope={dirty:i,ctx:p}),w.$set(m)},i(p){d||(C(w.$$.fragment,p),d=!0)},o(p){M(w.$$.fragment,p),d=!1},d(p){p&&u(e),K(w)}}}async function ot({fetch:l,url:e,session:t}){var a,o;const s=e.searchParams.get("email"),r=e.searchParams.get("token");return!r||!s||((a=t==null?void 0:t.user)==null?void 0:a.email)&&((o=t==null?void 0:t.user)==null?void 0:o.email)!==s?{redirect:"/error",status:303}:{status:200,props:{email:s,token:r}}}const Y="The magic link you used has expired. Magic links expire after 5 minutes for your security.",Z="Magic links are single use. Please request a new one.";let Ge=!1;function Ke(l,e,t){let s;Pe(l,Me,R=>t(10,s=R));let{token:r}=e,{email:a}=e,o="",$=!0,w=!1,d="";const p=async()=>{var N;if(o.length<8)return;t(2,w=!0),await Ce(async()=>{const U=await(await fetch("/proxy/update-password",de({query:Be,variables:{password:o,token:r,email:a}}))).json();if(U.error)return U.error.message===Y||U.error.message==="Token in magic link does not match the one that was most recently issued"?(t(3,d=Y),!1):U.error.message===Z?(t(3,d=Z),!1):(t(3,d="An unknown error occurred"),!1);const T=await(await fetch("/proxy/current-user",de({query:Le(`
            id
            username
            email
            emailIsVerified
            banned
            createdAt
            cred
            isAdmin
            `)}))).json();return Se.update(D=>fe(ue({},D),{user:T})),!0})&&await Ie((N=s==null?void 0:s.url)!=null?N:"/")};function i(){o=this.value,t(0,o)}function m(){o=this.value,t(0,o)}const h=()=>t(1,$=!$);return l.$$set=R=>{"token"in R&&t(5,r=R.token),"email"in R&&t(6,a=R.email)},[o,$,w,d,p,r,a,i,m,h]}class it extends ye{constructor(e){super();ve(this,e,Ke,Fe,Ee,{token:5,email:6})}}export{it as default,ot as load};
